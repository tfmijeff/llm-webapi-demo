<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å…§éƒ¨ LLM çŸ¥è­˜åŠ©ç†ï¼ˆDemoï¼‰</title>
    <style>
        body {
            font-family: Arial, "Microsoft JhengHei", sans-serif;
            background-color: #f5f5f5;
            padding: 40px;
        }
        .container {
            max-width: 700px;
            margin: auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        h1 {
            font-size: 20px;
            margin-bottom: 20px;
        }
        textarea {
            width: 100%;
            height: 100px;
            font-size: 14px;
            padding: 10px;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
        }
        .answer {
            margin-top: 20px;
            background: #f0f0f0;
            padding: 15px;
            white-space: pre-wrap;
        }

        /* ğŸ”½ æ–°å¢ï¼šæª¢ç´¢èªªæ˜è¡¨æ ¼æ¨£å¼ */
        table {
            margin-top: 20px;
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #eeeeee;
        }
        .note {
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>å…§éƒ¨ LLM çŸ¥è­˜åŠ©ç†ï¼ˆPoC Demoï¼‰</h1>

    <textarea
        id="question"
        placeholder="è«‹è¼¸å…¥ä½ çš„å•é¡Œï¼Œä¾‹å¦‚ï¼šè«‹èªªæ˜å¼·åˆ¶éšªç†è³ æµç¨‹ï¼ˆä¾å…§éƒ¨ä½œæ¥­åŸå‰‡ï¼‰"
    ></textarea>
    <br>
    <button onclick="ask()">é€å‡ºå•é¡Œ</button>

    <div id="answer" class="answer"></div>

    <!-- ğŸ”½ æ–°å¢ï¼šRAG æª¢ç´¢èªªæ˜ -->
    <h3>ğŸ” æª¢ç´¢ä¾æ“šèªªæ˜</h3>

    <table id="retrievalTable">
        <thead>
            <tr>
                <th>å‘½ä¸­è©æ¢</th>
                <th>ç›¸é—œåˆ†æ•¸</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="2">å°šæœªæŸ¥è©¢</td>
            </tr>
        </tbody>
    </table>

    <div class="note">
        â€» æœ¬è¡¨é¡¯ç¤ºæœ¬æ¬¡å›ç­”å¯¦éš›ä½¿ç”¨çš„å…§éƒ¨è©æ¢ï¼Œç”¨æ–¼èªªæ˜ RAG æª¢ç´¢ä¾æ“šã€‚
    </div>
<h3>ğŸ“˜ è©æ¢é—œéµå­—ï¼ˆAliasï¼‰å°ç…§è¡¨</h3>

<table id="aliasTable">
  <thead>
    <tr>
      <th>Aliasï¼ˆé—œéµå­—ï¼‰</th>
      <th>å°æ‡‰è©æ¢</th>
      <th>ä¾†æºæª”æ¡ˆ</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="note">
  â€» æœ¬è¡¨åƒ…ç”¨æ–¼èªªæ˜ç³»çµ±ç›®å‰è¨­å®šä¹‹é—œéµå­—èˆ‡è©æ¢å°æ‡‰é—œä¿‚ï¼Œä¸ä»£è¡¨ AI å³æ™‚æ¨è«–çµæœã€‚
</div>

    
</div>

<script>
async function ask() {
    const questionInput = document.getElementById("question");
    const answerDiv = document.getElementById("answer");
    const button = document.querySelector("button");
    const tableBody = document.querySelector("#retrievalTable tbody");

    const question = questionInput.value.trim();
    if (!question) {
        answerDiv.innerText = "è«‹å…ˆè¼¸å…¥å•é¡Œã€‚";
        return;
    }

    // UI ç‹€æ…‹
    button.disabled = true;
    button.innerText = "æ€è€ƒä¸­â€¦";
    answerDiv.innerText = "AI æ€è€ƒä¸­ï¼Œè«‹ç¨å€™â€¦";
    tableBody.innerHTML = `<tr><td colspan="2">æª¢ç´¢ä¸­â€¦</td></tr>`;

    try {
        const response = await fetch("/ask", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question })
        });

        const data = await response.json();

        // é¡¯ç¤ºå›ç­”
        answerDiv.innerText = data.answer || "æœªå–å¾—å›ç­”";

        // ğŸ”½ å¡«å…¥æª¢ç´¢ Table
        tableBody.innerHTML = "";

        if (data.retrieval && data.retrieval.length > 0) {
            data.retrieval.forEach(item => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${item.title}</td>
                    <td>${item.score}</td>
                `;
                tableBody.appendChild(tr);
            });
        } else {
            tableBody.innerHTML = `<tr><td colspan="2">æœ¬æ¬¡æŸ¥ç„¡å¯ç”¨å…§éƒ¨è©æ¢</td></tr>`;
        }

    } catch (err) {
        answerDiv.innerText = "ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message;
        tableBody.innerHTML = `<tr><td colspan="2">éŒ¯èª¤</td></tr>`;
    } finally {
        button.disabled = false;
        button.innerText = "é€å‡ºå•é¡Œ";
    }
}

const aliasCatalog = [
  {
    title: "13.è»Šé«”æå¤±ä¿éšªç†è³ ä½œæ¥­",
    source: "claims_auto_own_damage.json",
    aliases: [
    "è»Šé«”éšª",
    "è»Šé«”æå¤±æ€éº¼è³ ",
    "è»Šå­æ’å£äº†",
    "è‡ªæ’ç†è³ ",
    "è»Šé«”éšªç†è³ æµç¨‹",
    "ä¿®è»Šä¿éšªæ€éº¼ç”³è«‹",
    "è»Šæç†è³ "
    ]
  },
  {
    title: "14.æ±½(æ©Ÿ)è»Šç«Šç›œæå¤±ä¿éšªç†è³ ä½œæ¥­",
    source: "claims_auto_theft",
    aliases:[
    "è»Šå­è¢«å·",
    "æ±½è»Šè¢«å·",
    "æ©Ÿè»Šè¢«å·",
    "è»Šè¼›å¤±ç«Š",
    "è»Šå­å¤±ç«Šæ€éº¼è¾¦",
    "ç«Šç›œéšªç†è³ ",
    "è»Šè¢«å·å¯ä»¥ç”³è«‹ç†è³ å—",
    "å¤±ç«Šç†è³ æµç¨‹"
  ]
  },
  {
    title: "15.ä»»æ„æ±½è»Šç¬¬ä¸‰äººè²¬ä»»éšª-è²¡æç†è³ ä½œæ¥­",
    source: "claims_auto_third_party_property",
    aliases: [
    "ç¬¬ä¸‰äººè²¬ä»»éšª",
    "æ’åˆ°åˆ¥äººçš„è»Š",
    "è³ å°æ–¹è»Šå­",
    "è²¡æç†è³ ",
    "ç¬¬ä¸‰äººè²¡ææ€éº¼è³ ",
    "ä»»æ„éšªè²¡æ",
    "è³ å„Ÿå°æ–¹ä¿®è»Šè²»"
  ]
  },
  {
    title: "11.å¼·åˆ¶æ±½è»Šè²¬ä»»ä¿éšªç†è³ ä½œæ¥­",
    source: "claims_compulsory_auto_liability",
    aliases: [ "å¼·åˆ¶éšªç†è³ ",
    "å¼·åˆ¶æ±½è»Šè²¬ä»»éšª",
    "å¼·åˆ¶éšªæ€éº¼è³ ",
    "è»Šç¦å¼·åˆ¶éšª",
    "å¼·åˆ¶éšªç”³è«‹",
    "å¼·åˆ¶éšªç†è³ æµç¨‹",
    "äº¤é€šäº‹æ•…å¼·åˆ¶éšª"
    ]
  },
  {
    title: "04.ç›¸é©—å±é«”æš¨æ­»äº¡è­‰æ˜æ›¸æŸ¥è©¢æ¯”å°ä½œæ¥­",
    source: "claims_death_certificate_verification",
    aliases: [
    "æ­»äº¡è­‰æ˜æ›¸",
    "èº«æ•…æ¡ˆä»¶",
    "æ­»äº¡ç†è³ ",
    "æ­»äº¡è­‰æ˜æŸ¥æ ¸",
    "ç›¸é©—å±é«”",
    "æ­»äº¡æ–‡ä»¶æ¯”å°",
    "èº«æ•…æ¡ˆä»¶è¦ä»€éº¼æ–‡ä»¶"
    ]
  }
];

function renderAliasTable() {
  const tbody = document.querySelector("#aliasTable tbody");
  tbody.innerHTML = "";

  aliasCatalog.forEach(entry => {
    entry.aliases.forEach(alias => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${alias}</td>
        <td>${entry.title}</td>
        <td>${entry.source}</td>
      `;
      tbody.appendChild(tr);
    });
  });
}

renderAliasTable();

// é é¢è¼‰å…¥æ™‚é¡¯ç¤º
renderAliasTable();
</script>

</body>
</html>
